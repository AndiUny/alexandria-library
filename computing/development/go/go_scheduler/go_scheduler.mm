<map version="1.0.1">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node CREATED="1589291675288" ID="ID_1522010724" MODIFIED="1589292032711" TEXT="Go Scheduler">
<node CREATED="1589291980782" ID="ID_832523280" MODIFIED="1589296745462" POSITION="right" TEXT="OS Scheduler">
<icon BUILTIN="full-1"/>
<node CREATED="1589291991623" FOLDED="true" ID="ID_833789849" MODIFIED="1589292196946" TEXT="Introduction">
<icon BUILTIN="full-0"/>
<node CREATED="1589291995139" ID="ID_1213024889" MODIFIED="1589292014617" TEXT="Scheduler allows multithreaded Go programs">
<node CREATED="1589292017797" ID="ID_587795151" MODIFIED="1589292020837" TEXT="efficient"/>
<node CREATED="1589292021219" ID="ID_498549372" MODIFIED="1589292022777" TEXT="performant"/>
</node>
<node CREATED="1589292073094" ID="ID_1392838348" MODIFIED="1589292080914" TEXT="... due to sympathies between">
<node CREATED="1589292081096" ID="ID_834088347" MODIFIED="1589292083371" TEXT="Go scheduler"/>
<node CREATED="1589292083736" ID="ID_1672711331" MODIFIED="1589292090527" TEXT="OS scheduler"/>
</node>
<node CREATED="1589292101525" ID="ID_1152136024" MODIFIED="1589292116209" TEXT="For this to matter, code"/>
<node CREATED="1589292116692" ID="ID_26348180" MODIFIED="1589292130660" TEXT="... needs to be mechanically sympathetic"/>
<node CREATED="1589292136410" ID="ID_1926415538" MODIFIED="1589292144417" TEXT="... with how schedulers work"/>
<node CREATED="1589292172741" ID="ID_836613965" MODIFIED="1589292182628" TEXT="Critical part of foundational knowledge">
<node CREATED="1589292182866" ID="ID_181966732" MODIFIED="1589292185166" TEXT="Mechanics"/>
<node CREATED="1589292185514" ID="ID_1327274957" MODIFIED="1589292188067" TEXT="Semantics"/>
</node>
</node>
<node CREATED="1589292191655" FOLDED="true" ID="ID_1975461206" MODIFIED="1589292197912" TEXT="OS Scheduler">
<icon BUILTIN="full-1"/>
<node CREATED="1589292202557" ID="ID_1921647163" MODIFIED="1589292206602" TEXT="OS scheduler complex">
<node CREATED="1589292211677" ID="ID_134953794" MODIFIED="1589292220530" TEXT="Take into account hardware">
<node CREATED="1589292220736" ID="ID_1682581779" MODIFIED="1589292222098" TEXT="Setup"/>
<node CREATED="1589292222518" ID="ID_928484809" MODIFIED="1589292223437" TEXT="Layout"/>
<node CREATED="1589292234334" ID="ID_829731360" MODIFIED="1589292237331" TEXT="Includes">
<node CREATED="1589292237538" ID="ID_458489070" MODIFIED="1589292240548" TEXT="Multiple processors"/>
<node CREATED="1589292240874" ID="ID_1433906481" MODIFIED="1589292242839" TEXT="Multiple cores"/>
<node CREATED="1589292243229" ID="ID_91325199" MODIFIED="1589292246281" TEXT="CPU caches"/>
<node CREATED="1589292246748" ID="ID_1163413568" LINK="https://frankdenneman.nl/2016/07/06/introduction-2016-numa-deep-dive-series/" MODIFIED="1589292257105" TEXT="NUMA"/>
</node>
</node>
</node>
<node CREATED="1589292272341" ID="ID_1069105424" MODIFIED="1589292274103" TEXT="Program">
<node CREATED="1589292274334" ID="ID_826442055" MODIFIED="1589292281111" TEXT="Serie of sequential execution"/>
<node CREATED="1589292297671" ID="ID_1266725353" MODIFIED="1589292303670" TEXT="... executed by Threads">
<node CREATED="1589292309380" ID="ID_1658054551" MODIFIED="1589292313861" TEXT="&quot;path of execution&quot;"/>
</node>
<node CREATED="1589292327711" ID="ID_1417043959" MODIFIED="1589292334446" TEXT="When running">
<node CREATED="1589292334583" ID="ID_1405028426" MODIFIED="1589292338450" TEXT="Creates a Process"/>
<node CREATED="1589292339007" ID="ID_35535084" MODIFIED="1589292346039" TEXT="... which is given a Thread"/>
</node>
</node>
<node CREATED="1589292351230" ID="ID_1453704079" MODIFIED="1589292367831" TEXT="Threads">
<node CREATED="1589292352451" ID="ID_395673089" MODIFIED="1589292357723" TEXT="Can create more Threads"/>
<node CREATED="1589292368348" ID="ID_1182945159" MODIFIED="1589292376168" TEXT="Run independently of each others"/>
<node CREATED="1589292382436" ID="ID_1878998695" MODIFIED="1589292391526" TEXT="Scheduling decisions made at Thread level"/>
<node CREATED="1589292403719" ID="ID_1716676028" MODIFIED="1589292405645" TEXT="Can run">
<node CREATED="1589292405953" ID="ID_1232064957" MODIFIED="1589292407558" TEXT="Concurently">
<node CREATED="1589292407724" ID="ID_40842891" MODIFIED="1589292834690" TEXT="Taking turns"/>
<node CREATED="1589292433880" ID="ID_375463941" MODIFIED="1589292841960" TEXT="... on a core"/>
</node>
<node CREATED="1589292415809" ID="ID_329900903" MODIFIED="1589292417628" TEXT="Parallel">
<node CREATED="1589292417819" ID="ID_1393867086" MODIFIED="1589292426375" TEXT="Running at the same time"/>
<node CREATED="1589292426916" ID="ID_1615433240" MODIFIED="1589292430494" TEXT="... on different cores"/>
</node>
</node>
<node CREATED="1589292448182" ID="ID_175244372" MODIFIED="1589292455986" TEXT="Maintain their own state"/>
<node CREATED="1589292456543" ID="ID_1177411507" MODIFIED="1589292867923" TEXT="... for execution">
<node CREATED="1589292464160" ID="ID_1394587209" MODIFIED="1589292465021" TEXT="safe"/>
<node CREATED="1589292465410" ID="ID_1738916800" MODIFIED="1589292466533" TEXT="local"/>
<node CREATED="1589292466993" ID="ID_1438108937" MODIFIED="1589292470226" TEXT="independent"/>
</node>
</node>
<node CREATED="1589292480332" ID="ID_1761795300" MODIFIED="1589292486578" TEXT="OS Scheduler">
<node CREATED="1589292486752" ID="ID_545780935" MODIFIED="1589292879928" TEXT="Don&apos;t let core idle if Thread can be executed">
<icon BUILTIN="full-1"/>
</node>
<node CREATED="1589292512181" ID="ID_1356638235" MODIFIED="1589292888230" TEXT="Create illusion that all Thread execute at same time">
<icon BUILTIN="full-2"/>
<node CREATED="1589292558982" ID="ID_1273836137" MODIFIED="1589292571557" TEXT="Run Threads with high priority"/>
<node CREATED="1589292585290" ID="ID_155101967" MODIFIED="1589292595496" TEXT="... but Thread with lower priority"/>
<node CREATED="1589292596204" ID="ID_367975972" MODIFIED="1589292602456" TEXT="... can&apos;t be starved of execution time"/>
<node CREATED="1589292602916" ID="ID_134117898" MODIFIED="1589292922092" TEXT="... needs quick / smart decisions"/>
</node>
</node>
</node>
<node CREATED="1589292661946" FOLDED="true" ID="ID_1467650007" MODIFIED="1589296725211" TEXT="Executing instructions">
<icon BUILTIN="full-2"/>
<node CREATED="1589292676633" ID="ID_1102431406" LINK="https://en.wikipedia.org/wiki/Program_counter" MODIFIED="1589292699793" TEXT="Program counted (PC)">
<node CREATED="1589292684292" ID="ID_707617983" MODIFIED="1589292693083" TEXT="Called as well Instruction Pointer (IP)"/>
<node CREATED="1589292705672" ID="ID_326716484" MODIFIED="1589292723822" TEXT="Allows Thread to keep track of next instruction to execute"/>
<node CREATED="1589292733562" ID="ID_74968861" MODIFIED="1589292737919" TEXT="In most processor">
<node CREATED="1589292738355" ID="ID_257011987" MODIFIED="1589292743333" TEXT="... point to the next instruction"/>
<node CREATED="1589292743676" ID="ID_1329636159" MODIFIED="1589292746047" TEXT="... not the current one"/>
</node>
<node CREATED="1589292960022" ID="ID_1913732204" MODIFIED="1589292964328" TEXT="Illustration">
<icon BUILTIN="licq"/>
<node CREATED="1589292964720" ID="ID_1371693544" MODIFIED="1589292967466">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="instruction_pointer.png" />
  </body>
</html>
</richcontent>
</node>
</node>
<node CREATED="1589292998145" ID="ID_263491842" MODIFIED="1589293012170" TEXT="Stack trace in Go programs">
<node CREATED="1589293494785" ID="ID_1044958872" MODIFIED="1589293498875" TEXT="Example">
<icon BUILTIN="wizard"/>
<node CREATED="1589293012783" ID="ID_920725218" MODIFIED="1589293280988" TEXT="Example panic">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <pre http-equiv="content-type" content="text/html; charset=utf-8"><code>goroutine 1 [running]:
   main.example(0xc000042748, 0x2, 0x4, 0x106abae, 0x5, 0xa)
       stack_trace/example1/example1.go:13 +0x39                 &lt;- LOOK HERE
   main.main()
       stack_trace/example1/example1.go:8 +0x72                  &lt;- LOOK HERE</code></pre>
  </body>
</html></richcontent>
<node CREATED="1589293079400" ID="ID_617323151" MODIFIED="1589293147908" TEXT="PC value offsets">
<node CREATED="1589293148144" ID="ID_1772527049" MODIFIED="1589293161757" TEXT="+0x72">
<font ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1589293152782" ID="ID_102571768" MODIFIED="1589293162238" TEXT="+0x39">
<font ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
<node CREATED="1589293115359" ID="ID_925220681" MODIFIED="1589293122843" TEXT="... representing Thread next execution"/>
<node CREATED="1589293125951" ID="ID_857729007" MODIFIED="1589293131417" TEXT="... inside function"/>
<node CREATED="1589293089123" ID="ID_766285012" MODIFIED="1589293095075" TEXT="... if program didn&apos;t crash"/>
</node>
<node CREATED="1589293269149" ID="ID_1977063899" MODIFIED="1589293295101" TEXT="Code responsible">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <pre http-equiv="content-type" content="text/html; charset=utf-8"><code>https://github.com/ardanlabs/gotraining/blob/master/topics/go/profiling/stack_trace/example1/example1.go

07 func main() {
08     example(make([]string, 2, 4), &quot;hello&quot;, 10)
09 }

12 func example(slice []string, str string, i int) {
13    panic(&quot;Want stack trace&quot;)
14 }</code></pre>
  </body>
</html></richcontent>
<node CREATED="1589293148144" ID="ID_924402642" MODIFIED="1589293161757" TEXT="+0x72">
<font ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1589293307246" ID="ID_994666295" MODIFIED="1589293314861" TEXT="57 (base 10)"/>
<node CREATED="1589293342784" ID="ID_18999510" MODIFIED="1589293362976" TEXT="... number of bytes below starting instruction"/>
<node CREATED="1589293357826" ID="ID_350340156" MODIFIED="1589293359432" TEXT="... of function"/>
</node>
</node>
<node CREATED="1589293472508" ID="ID_1589887245" MODIFIED="1589293478402" TEXT="objdump">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <pre http-equiv="content-type" content="text/html; charset=utf-8"><code>$ go tool objdump -S -s &quot;main.example&quot; ./example1
TEXT main.example(SB) stack_trace/example1/example1.go
func example(slice []string, str string, i int) {
  0x104dfa0&#x9;&#x9;65488b0c2530000000&#x9;MOVQ GS:0x30, CX
  0x104dfa9&#x9;&#x9;483b6110&#x9;&#x9;CMPQ 0x10(CX), SP
  0x104dfad&#x9;&#x9;762c&#x9;&#x9;&#x9;JBE 0x104dfdb
  0x104dfaf&#x9;&#x9;4883ec18&#x9;&#x9;SUBQ $0x18, SP
  0x104dfb3&#x9;&#x9;48896c2410&#x9;&#x9;MOVQ BP, 0x10(SP)
  0x104dfb8&#x9;&#x9;488d6c2410&#x9;&#x9;LEAQ 0x10(SP), BP
&#x9;panic(&quot;Want stack trace&quot;)
  0x104dfbd&#x9;&#x9;488d059ca20000&#x9;LEAQ runtime.types+41504(SB), AX
  0x104dfc4&#x9;&#x9;48890424&#x9;&#x9;MOVQ AX, 0(SP)
  0x104dfc8&#x9;&#x9;488d05a1870200&#x9;LEAQ main.statictmp_0(SB), AX
  0x104dfcf&#x9;&#x9;4889442408&#x9;&#x9;MOVQ AX, 0x8(SP)
  0x104dfd4&#x9;&#x9;e8c735fdff&#x9;&#x9;CALL runtime.gopanic(SB)
  0x104dfd9&#x9;&#x9;0f0b&#x9;&#x9;&#x9;UD2              &lt;--- LOOK HERE PC(+0x39)</code></pre>
  </body>
</html></richcontent>
<node CREATED="1589293481776" ID="ID_675357200" MODIFIED="1589293484656" TEXT="Last line is PC"/>
<node CREATED="1589293485034" ID="ID_485827027" MODIFIED="1589293491028" TEXT="... last before is the panic"/>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1589293522468" FOLDED="true" ID="ID_1659681586" MODIFIED="1589296726638" TEXT="Thread States">
<icon BUILTIN="full-3"/>
<node CREATED="1589293538140" ID="ID_991104069" MODIFIED="1589293545861" TEXT="Dictates role scheduler takes with Thread"/>
<node CREATED="1589293556614" ID="ID_1543793818" MODIFIED="1589293564465" TEXT="Thread can be in 1 of 3 states">
<node CREATED="1589293564663" ID="ID_14810574" MODIFIED="1589293572235" TEXT="Waiting">
<icon BUILTIN="full-1"/>
<node CREATED="1589293582157" ID="ID_465704740" MODIFIED="1589293585379" TEXT="Thread stopped"/>
<node CREATED="1589293585728" ID="ID_822793605" MODIFIED="1589293591486" TEXT="Waiting for something to continue"/>
<node CREATED="1589293593000" ID="ID_61217596" MODIFIED="1589293594398" TEXT="Example">
<node CREATED="1589293595107" ID="ID_972773246" MODIFIED="1589293600011" TEXT="Waiting for hardware">
<node CREATED="1589293600163" ID="ID_116064331" MODIFIED="1589293601253" TEXT="Disk"/>
<node CREATED="1589293601564" ID="ID_1174670321" MODIFIED="1589293602694" TEXT="Network"/>
</node>
<node CREATED="1589293603368" ID="ID_1486209808" MODIFIED="1589293606797" TEXT="OS">
<node CREATED="1589293607003" ID="ID_478377039" MODIFIED="1589293610293" TEXT="System calls"/>
</node>
<node CREATED="1589293611332" ID="ID_566912623" MODIFIED="1589293625490" TEXT="Synchronization calls">
<node CREATED="1589293629101" ID="ID_238535325" MODIFIED="1589293632453" TEXT="atomic"/>
<node CREATED="1589293632993" ID="ID_1207766153" MODIFIED="1589293635743" TEXT="mutexes"/>
</node>
</node>
<node CREATED="1589293641095" ID="ID_1153617806" LINK="https://en.wikipedia.org/wiki/Latency_(engineering)" MODIFIED="1589293659908" TEXT="Latencies"/>
<node CREATED="1589293646041" ID="ID_888810469" MODIFIED="1589293651709" TEXT="Root cause for bad performance"/>
</node>
<node CREATED="1589293567681" ID="ID_1944737675" MODIFIED="1589293573397" TEXT="Runnable">
<icon BUILTIN="full-2"/>
<node CREATED="1589293688532" ID="ID_1359554149" MODIFIED="1589293693422" TEXT="Thread wants time on a core"/>
<node CREATED="1589293694961" ID="ID_1522517259" MODIFIED="1589293705329" TEXT="... to execute its assigned machine instructions"/>
<node CREATED="1589293709007" ID="ID_170979564" MODIFIED="1589293713175" TEXT="If many Threads want time">
<node CREATED="1589293734700" ID="ID_253977973" MODIFIED="1589293738168" TEXT="Wait longer to have it"/>
<node CREATED="1589293738511" ID="ID_273131185" MODIFIED="1589293744461" TEXT="Time shortened when they have it"/>
<node CREATED="1589293753901" ID="ID_123541951" MODIFIED="1589293760072" TEXT="Root cause of bad performance"/>
</node>
</node>
<node CREATED="1589293569382" ID="ID_1754682917" MODIFIED="1589293574769" TEXT="Executing">
<icon BUILTIN="full-3"/>
<node CREATED="1589293769046" ID="ID_270442681" MODIFIED="1589293772593" TEXT="Thread placed on a core"/>
<node CREATED="1589293772983" ID="ID_889960912" MODIFIED="1589293777765" TEXT="Execute machine instructions"/>
<node CREATED="1589293781561" ID="ID_995939246" MODIFIED="1589293786292" TEXT="This is what everybody wants">
<node CREATED="1589293788647" ID="ID_1913496983" MODIFIED="1589293795408" TEXT="Job getting done"/>
</node>
</node>
</node>
</node>
<node CREATED="1589293797407" FOLDED="true" ID="ID_1424689980" MODIFIED="1589296727479" TEXT="Types of Work">
<icon BUILTIN="full-4"/>
<node CREATED="1589293802858" ID="ID_415019320" MODIFIED="1589293809628" TEXT="Two types of work a Thread can do">
<node CREATED="1589293809794" ID="ID_406491504" MODIFIED="1589293844213" TEXT="CPU-Bound">
<icon BUILTIN="full-1"/>
<node CREATED="1589293818108" ID="ID_1988050862" MODIFIED="1589293829081" TEXT="Never creates waiting state"/>
<node CREATED="1589293838145" ID="ID_1245731574" MODIFIED="1589293843334" TEXT="Constantly make calculation"/>
<node CREATED="1589293851551" ID="ID_599453130" MODIFIED="1589293863367" TEXT="Example">
<icon BUILTIN="wizard"/>
<node CREATED="1589293854929" ID="ID_918957127" MODIFIED="1589293860809" TEXT="Thread calculating PI to Nth digit"/>
</node>
</node>
<node CREATED="1589293866083" ID="ID_1705009860" MODIFIED="1589293870592" TEXT="IO-Bound">
<node CREATED="1589293874264" ID="ID_1753992254" MODIFIED="1589293883650" TEXT="Works causing Thread to go Waiting state"/>
<node CREATED="1589293908999" ID="ID_893241604" MODIFIED="1589293912569" TEXT="Examples">
<icon BUILTIN="wizard"/>
<node CREATED="1589293888184" ID="ID_1786410433" MODIFIED="1589293896814" TEXT="Request to">
<node CREATED="1589293897019" ID="ID_1431209742" MODIFIED="1589293898185" TEXT="Network"/>
<node CREATED="1589293898510" ID="ID_1390065197" MODIFIED="1589293901197" TEXT="Database"/>
<node CREATED="1589293901637" ID="ID_381914455" MODIFIED="1589293904564" TEXT="System call"/>
<node CREATED="1589293905879" ID="ID_413584816" MODIFIED="1589293907966" TEXT="..."/>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1589293928964" FOLDED="true" ID="ID_158389861" MODIFIED="1589296728464" TEXT="Context Switching">
<icon BUILTIN="full-5"/>
<node CREATED="1589293938287" ID="ID_1405253729" MODIFIED="1589293946913" TEXT="If running either on">
<node CREATED="1589293940589" ID="ID_1564620575" MODIFIED="1589293941631" TEXT="Linux"/>
<node CREATED="1589293942154" ID="ID_488045484" MODIFIED="1589293948334" TEXT="Mac"/>
<node CREATED="1589293948765" ID="ID_1071800464" MODIFIED="1589293951256" TEXT="Windows"/>
</node>
<node CREATED="1589293953888" ID="ID_824935017" MODIFIED="1589293960470" TEXT="... OS that have preemptive scheduler">
<node CREATED="1589293965905" ID="ID_748814500" MODIFIED="1589293987742" TEXT="Scheduler impredictable for total Threads running at given time">
<icon BUILTIN="full-1"/>
<node CREATED="1589294002262" ID="ID_693431637" MODIFIED="1589294012721" TEXT="Thread priorities"/>
<node CREATED="1589294013133" ID="ID_373883360" MODIFIED="1589294014156" TEXT="Events"/>
<node CREATED="1589294014520" ID="ID_1353641319" MODIFIED="1589294020794" TEXT="... make impossible to determine"/>
<node CREATED="1589294021156" ID="ID_1137574617" MODIFIED="1589294028600" TEXT="... what scheduler will choose"/>
</node>
<node CREATED="1589294050424" ID="ID_1872532330" MODIFIED="1589294107944" TEXT="If you want determinism in app">
<icon BUILTIN="full-2"/>
<node CREATED="1589294093734" ID="ID_957699289" MODIFIED="1589294098401" TEXT="Need to control Thread">
<node CREATED="1589294098646" ID="ID_1297602003" MODIFIED="1589294102602" TEXT="Synchronization"/>
<node CREATED="1589294102976" ID="ID_693268140" MODIFIED="1589294104966" TEXT="Orchestration"/>
</node>
</node>
</node>
<node CREATED="1589294126029" ID="ID_960692389" MODIFIED="1589294131260" TEXT="Context Switch">
<node CREATED="1589294131411" ID="ID_1511966362" MODIFIED="1589294140378" TEXT="Physical act of swapping Threads on a core"/>
<node CREATED="1589294146933" ID="ID_1998754921" MODIFIED="1589294156332" TEXT="Thread selected from run queue move to Executing state"/>
<node CREATED="1589294166341" ID="ID_380402607" MODIFIED="1589294180316" TEXT="Thread pulled can come back to">
<node CREATED="1589294180593" ID="ID_598379336" MODIFIED="1589294194260" TEXT="Runnable state">
<node CREATED="1589294185432" ID="ID_243886332" MODIFIED="1589294188149" TEXT="if it can still run"/>
</node>
<node CREATED="1589294189038" ID="ID_1953165641" MODIFIED="1589294192036" TEXT="Waiting state">
<node CREATED="1589294201887" ID="ID_1579439631" MODIFIED="1589294207683" TEXT="IO-Bound type request"/>
</node>
</node>
<node CREATED="1589294211060" ID="ID_1486760062" MODIFIED="1589294215766" TEXT="Considered expensive">
<node CREATED="1589294216163" ID="ID_490359592" MODIFIED="1589294221435" TEXT="Take time to swap Threads"/>
<node CREATED="1589294227629" ID="ID_1045218575" LINK="https://eli.thegreenplace.net/2018/measuring-context-switching-and-memory-overheads-for-linux-threads/" MODIFIED="1589294246669" TEXT="Between 1000 and 1500 nanoseconds"/>
<node CREATED="1589294282789" ID="ID_858130442" MODIFIED="1589294284349" TEXT="... ~12k to ~18k instructions of latency"/>
</node>
<node CREATED="1589294295264" ID="ID_1844987690" MODIFIED="1589294384962" TEXT="If program focused on ">
<node CREATED="1589294385351" ID="ID_847660501" MODIFIED="1589294389339" TEXT="IO-Bound">
<node CREATED="1589294309265" ID="ID_1881248277" MODIFIED="1589294317027" TEXT="Context switches is an advantage"/>
<node CREATED="1589294323503" ID="ID_1490222293" MODIFIED="1589294330454" TEXT="Threads has to wait anyway"/>
<node CREATED="1589294331222" ID="ID_844718361" MODIFIED="1589294334887" TEXT="... so others can run"/>
<node CREATED="1589294335607" ID="ID_124798862" MODIFIED="1589294343419" TEXT="Core always work">
<node CREATED="1589294351125" ID="ID_315879399" MODIFIED="1589294356706" TEXT="Don&apos;t allow core to go idle"/>
<node CREATED="1589294357119" ID="ID_1811468709" MODIFIED="1589294361208" TEXT="... if there is work!"/>
</node>
</node>
<node CREATED="1589294374422" ID="ID_1977634132" MODIFIED="1589294380623" TEXT="CPU-Bound">
<node CREATED="1589294395017" ID="ID_353194929" MODIFIED="1589294408319" TEXT="Performance nightmare"/>
<node CREATED="1589294412352" ID="ID_1487171232" MODIFIED="1589294417074" TEXT="Thread always have work to do"/>
<node CREATED="1589294417408" ID="ID_327134592" MODIFIED="1589294420695" TEXT="Stopping it will cost"/>
</node>
</node>
</node>
</node>
<node CREATED="1589294433972" FOLDED="true" ID="ID_1291301156" MODIFIED="1589296729455" TEXT="Less is more">
<icon BUILTIN="full-6"/>
<node CREATED="1589294478955" ID="ID_165821530" MODIFIED="1589294484530" TEXT="When processor had only one core">
<node CREATED="1589294484736" ID="ID_1070191695" MODIFIED="1589294492937" TEXT="Scheduling wasn&apos;t compicated"/>
<node CREATED="1589294494639" ID="ID_91555910" MODIFIED="1589294501729" TEXT="Only one Thread executing at any time"/>
<node CREATED="1589294505320" ID="ID_1071147259" LINK="https://lwn.net/Articles/404993/" MODIFIED="1589294589871" TEXT="Define scheduler period">
<node CREATED="1589294509993" ID="ID_746261661" MODIFIED="1589294523661" TEXT="Attempt to execute all runnable Threads"/>
<node CREATED="1589294549827" ID="ID_843371428" MODIFIED="1589294557070" TEXT="... within period of time">
<node CREATED="1589294559200" ID="ID_362407558" MODIFIED="1589294573264" TEXT="... scheduling period / number of Thread to run"/>
</node>
</node>
<node CREATED="1589294619465" ID="ID_956786514" MODIFIED="1589294621118" TEXT="Example">
<node CREATED="1589294622131" ID="ID_1445947421" MODIFIED="1589294633879" TEXT="Scheduler period = 1000ms (1s)"/>
<node CREATED="1589294628350" ID="ID_402682466" MODIFIED="1589294662252" TEXT="10 Threads to run">
<node CREATED="1589294650757" ID="ID_334786313" MODIFIED="1589294655158" TEXT="Each thread 100ms each"/>
</node>
<node CREATED="1589294655735" ID="ID_1618204361" MODIFIED="1589294659497" TEXT="100 Threads to run">
<node CREATED="1589294662983" ID="ID_563023751" MODIFIED="1589294668777" TEXT="Each 10ms"/>
</node>
<node CREATED="1589294669297" ID="ID_788240009" MODIFIED="1589294672970" TEXT="1000 Threads to run">
<node CREATED="1589294676198" ID="ID_1450909973" MODIFIED="1589294680999" TEXT="1ms?"/>
<node CREATED="1589294681419" ID="ID_155498281" MODIFIED="1589294709076" TEXT="Percentage of context switches"/>
<node CREATED="1589294693485" ID="ID_664406221" MODIFIED="1589294696802" TEXT="... too significant"/>
<node CREATED="1589294698647" ID="ID_930294128" MODIFIED="1589294703636" TEXT="... for amount of running time"/>
</node>
<node CREATED="1589294722769" ID="ID_719647445" MODIFIED="1589294740992" TEXT="... needs a limit how small time slice can be"/>
<node CREATED="1589294756175" ID="ID_1343157836" MODIFIED="1589294762159" TEXT="... then increase scheduler period"/>
</node>
</node>
<node CREATED="1589294794732" ID="ID_181532270" LINK="https://blog.acolyer.org/2016/04/26/the-linux-scheduler-a-decade-of-wasted-cores/" MODIFIED="1589294802717" TEXT="Simplification scheduling decisions">
<node CREATED="1589294860701" ID="ID_680195971" MODIFIED="1589294868318" TEXT="You control number of Thread in your app"/>
<node CREATED="1589294869015" ID="ID_1561968188" MODIFIED="1589294873725" TEXT="When more Threads to consider"/>
<node CREATED="1589294876809" ID="ID_1307414213" MODIFIED="1589294882263" TEXT="... and IO-Bound happening"/>
<node CREATED="1589294882603" ID="ID_187236453" MODIFIED="1589294885274" TEXT="... it&apos;s chaos">
<node CREATED="1589294887874" ID="ID_1282204377" MODIFIED="1589294908627" TEXT="Take longer to">
<node CREATED="1589294908768" ID="ID_1160194659" MODIFIED="1589294910021" TEXT="schedule"/>
<node CREATED="1589294910337" ID="ID_1972971516" MODIFIED="1589294911496" TEXT="execute"/>
</node>
</node>
</node>
<node CREATED="1589294934537" ID="ID_818777183" MODIFIED="1589294978005" TEXT="Less Threads in a Runnable states"/>
<node CREATED="1589294946386" ID="ID_1191383435" MODIFIED="1589294956740" TEXT="... less scheduling overhead"/>
<node CREATED="1589294957429" ID="ID_1065385236" MODIFIED="1589294965210" TEXT="... more time each Threads get">
<node CREATED="1589294994791" ID="ID_1114566965" MODIFIED="1589294997960" TEXT="More work done!"/>
</node>
</node>
<node CREATED="1589294999410" FOLDED="true" ID="ID_1774934479" MODIFIED="1589296731246" TEXT="Find the Balance">
<icon BUILTIN="full-7"/>
<node CREATED="1589295022781" ID="ID_834634865" MODIFIED="1589295027414" TEXT="Balance to find between">
<node CREATED="1589295027644" ID="ID_1206070250" MODIFIED="1589295033452" TEXT="Number of cores you have"/>
<node CREATED="1589295036416" ID="ID_61379482" MODIFIED="1589295045201" TEXT="Number of Threads you need"/>
</node>
<node CREATED="1589295045781" ID="ID_1571815435" MODIFIED="1589295055990" TEXT="... to get best throughput for your app"/>
<node CREATED="1589295213307" ID="ID_1106379452" MODIFIED="1589295581124" TEXT="Thread pools to manage balance">
<node CREATED="1589295230153" ID="ID_1119407927" MODIFIED="1589295233904" TEXT="Not necessary anymore with Go"/>
<node CREATED="1589295251876" ID="ID_1836779416" MODIFIED="1589295283164" TEXT="Need to decide">
<node CREATED="1589295253561" ID="ID_1819811312" MODIFIED="1589295256527" TEXT="How many pools you need"/>
<node CREATED="1589295256868" ID="ID_1762440707" MODIFIED="1589295274663" TEXT="Max Threads per pool"/>
</node>
<node CREATED="1589295304533" ID="ID_1790879000" MODIFIED="1589295305899" TEXT="Example">
<node CREATED="1589295313116" ID="ID_1405915720" MODIFIED="1589295319804" TEXT="Windows NT with c++"/>
<node CREATED="1589295320537" ID="ID_217336719" MODIFIED="1589295332333" TEXT="3 Threads per core was magical">
<node CREATED="1589295336368" ID="ID_1019231907" MODIFIED="1589295343547" TEXT="Minimized latency cost"/>
<node CREATED="1589295344220" ID="ID_1584966357" MODIFIED="1589295347897" TEXT="... of context switching"/>
<node CREATED="1589295348302" ID="ID_1879019900" MODIFIED="1589295354495" TEXT="... while maximizing execution times"/>
<node CREATED="1589295354908" ID="ID_1961778219" MODIFIED="1589295356850" TEXT="... on core"/>
</node>
<node CREATED="1589295382534" ID="ID_1209530286" MODIFIED="1589295449629" TEXT="... Threads per pool for each core">
<node CREATED="1589295389259" ID="ID_1821256901" MODIFIED="1589295390396" TEXT="Min 1"/>
<node CREATED="1589295406094" ID="ID_782495290" MODIFIED="1589295408514" TEXT="Max 3"/>
</node>
<node CREATED="1589295456395" ID="ID_389772027" MODIFIED="1589295459872" TEXT="... other solutions">
<node CREATED="1589295460023" ID="ID_1105814346" MODIFIED="1589295470356" TEXT="2 threads per core">
<node CREATED="1589295463780" ID="ID_987748361" MODIFIED="1589295474949" TEXT="Idle time"/>
</node>
<node CREATED="1589295475638" ID="ID_589658122" MODIFIED="1589295478917" TEXT="4 threads per core">
<node CREATED="1589295479139" ID="ID_301686392" MODIFIED="1589295494053" TEXT="Costly latency of context switches"/>
</node>
</node>
</node>
<node CREATED="1589295514345" ID="ID_1320739120" MODIFIED="1589295520079" TEXT="Magic numbers don&apos;t work all the time">
<node CREATED="1589295520237" ID="ID_1071550674" MODIFIED="1589295536397" TEXT="If you do lot different type of work">
<node CREATED="1589295544214" ID="ID_334964630" MODIFIED="1589295548179" TEXT="Inconsistent latencies"/>
</node>
<node CREATED="1589295561799" ID="ID_562238459" MODIFIED="1589295567813" TEXT="Can get very complicated"/>
</node>
</node>
</node>
<node CREATED="1589295599228" FOLDED="true" ID="ID_1845107675" MODIFIED="1589296733020" TEXT="Cache Lines">
<icon BUILTIN="full-8"/>
<node CREATED="1589295613313" ID="ID_1325313909" MODIFIED="1589295621613" TEXT="Accessing data from main memory">
<node CREATED="1589295621826" ID="ID_1529238744" MODIFIED="1589295626148" TEXT="High latency costs!">
<node CREATED="1589295626473" ID="ID_1553086481" MODIFIED="1589295626993" TEXT="~100 to ~300 clock cycles"/>
</node>
<node CREATED="1589295637485" ID="ID_523299185" MODIFIED="1589295645516" TEXT="... so processors hav elocal caches"/>
<node CREATED="1589295645912" ID="ID_1126145110" MODIFIED="1589295652411" TEXT="... to keep data close to the hardware">
<node CREATED="1589295662831" ID="ID_59650628" MODIFIED="1589295678042" TEXT="only ~3 to ~40 clock cycles"/>
<node CREATED="1589295679627" ID="ID_1147346242" MODIFIED="1589295681881" TEXT="... depending on cache"/>
</node>
<node CREATED="1589295655051" ID="ID_384894146" MODIFIED="1589295656928" TEXT="... that need it"/>
</node>
<node CREATED="1589295687650" ID="ID_335605594" MODIFIED="1589295695127" TEXT="One aspect of performance">
<node CREATED="1589295695404" ID="ID_1729125233" MODIFIED="1589295702220" TEXT="How much data I can put into processor"/>
<node CREATED="1589295702742" ID="ID_1608862709" MODIFIED="1589295708181" TEXT="... to reduce data-access latency"/>
</node>
<node CREATED="1589295821967" ID="ID_944124837" MODIFIED="1589295855282" TEXT="Illustration">
<icon BUILTIN="licq"/>
<node CREATED="1589295848236" ID="ID_993175621" MODIFIED="1589295850938">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="cpu-cache.png" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1589295949322" ID="ID_1547345776" LINK="https://www.youtube.com/watch?v=WDIkqP4JbkE" MODIFIED="1589295978758" TEXT="Cache lines">
<node CREATED="1589295952228" ID="ID_635408078" MODIFIED="1589295961831" TEXT="Data exchanged between processor"/>
<node CREATED="1589295962213" ID="ID_555641640" MODIFIED="1589295965659" TEXT="... and main memory"/>
<node CREATED="1589295982044" ID="ID_1722349332" MODIFIED="1589295992150" TEXT="64 bytes of chunk in memory"/>
<node CREATED="1589296123882" ID="ID_1529166376" MODIFIED="1589296127481" TEXT="Exchanged between">
<node CREATED="1589296127671" ID="ID_99390591" MODIFIED="1589296128806" TEXT="Memory"/>
<node CREATED="1589296129250" ID="ID_1241912476" MODIFIED="1589296134864" TEXT="Caching system"/>
</node>
<node CREATED="1589296142201" ID="ID_1180255549" MODIFIED="1589296149527" TEXT="Each core has its own copy of any cache line needed">
<node CREATED="1589296152135" ID="ID_841749433" MODIFIED="1589296156731" TEXT="Hardware use"/>
<node CREATED="1589296157136" ID="ID_504675210" MODIFIED="1589296160076" TEXT="... value semantics"/>
</node>
<node CREATED="1589296180516" ID="ID_1518114112" MODIFIED="1589296205621" TEXT="... mutations to memory in multithreaded application">
<node CREATED="1589296191729" ID="ID_495386569" MODIFIED="1589296194517" TEXT="Nightmare!"/>
</node>
</node>
<node CREATED="1589296266868" ID="ID_1969650544" MODIFIED="1589296277650" TEXT="Multiple Threads can access data on same cache line">
<node CREATED="1589296285055" ID="ID_231047508" MODIFIED="1589296297548" TEXT="Each Thread get own copy"/>
<node CREATED="1589296287927" ID="ID_1359919450" MODIFIED="1589296302353" TEXT="... of Thread cache line"/>
</node>
<node CREATED="1589296364616" ID="ID_1046506713" MODIFIED="1589296374814" TEXT="When Thread make change to copy of cache line">
<node CREATED="1589296374990" ID="ID_131023702" MODIFIED="1589296379272" TEXT="All others copies of cache line"/>
<node CREATED="1589296379615" ID="ID_1863468629" MODIFIED="1589296382832" TEXT="... are marked dirty"/>
<node CREATED="1589296396845" ID="ID_213071181" MODIFIED="1589296405529" TEXT="... when another Thread read / write it"/>
<node CREATED="1589296406315" ID="ID_1444421002" MODIFIED="1589296416398" TEXT="... main memory access is required"/>
<node CREATED="1589296416772" ID="ID_1718313457" MODIFIED="1589296421110" TEXT="... to get new copy of cache line"/>
</node>
<node CREATED="1589296433017" ID="ID_372370826" MODIFIED="1589296442570" TEXT="... on 2-core processor it&apos;s not a big deal">
<node CREATED="1589296442760" ID="ID_1484982958" MODIFIED="1589296448639" TEXT="What about 32 core processor"/>
<node CREATED="1589296448988" ID="ID_1186652891" MODIFIED="1589296459852" TEXT="... running 32 Threads in parallel"/>
<node CREATED="1589296460272" ID="ID_976026941" MODIFIED="1589296467066" TEXT="... all accessing and mutating data"/>
<node CREATED="1589296467394" ID="ID_948037274" MODIFIED="1589296470161" TEXT="... on same cache line?"/>
<node CREATED="1589296475510" ID="ID_1203392961" MODIFIED="1589296479047" TEXT="Horrible latency">
<node CREATED="1589296496644" ID="ID_866107491" MODIFIED="1589296503703" TEXT="Even worst with 2 different processor"/>
<node CREATED="1589296504077" ID="ID_1654226818" MODIFIED="1589296514932" TEXT="... because latency processor-to-processor communication"/>
</node>
</node>
<node CREATED="1589296527332" ID="ID_1311002010" MODIFIED="1589296541871" TEXT="... Cache coherency problem">
<node CREATED="1589296543639" ID="ID_1356021376" MODIFIED="1589296552771" TEXT="Introduce false sharing problem"/>
<node CREATED="1589296555599" ID="ID_742447658" MODIFIED="1589296559957">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="false-sharing.png" />
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node CREATED="1589296619073" FOLDED="true" ID="ID_1792063787" MODIFIED="1589296740526" TEXT="Scheduling Decision Scenario">
<icon BUILTIN="full-9"/>
<node CREATED="1589296695651" ID="ID_402914685" MODIFIED="1589296699597" TEXT="Scheduling is complex!"/>
</node>
<node CREATED="1589296700682" ID="ID_1803891643" MODIFIED="1589296742206" TEXT="Conclusion">
<icon BUILTIN="full-1"/>
<icon BUILTIN="full-0"/>
</node>
</node>
</node>
</map>
